<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bob the Stickman — Community Games</title>
<style>
:root{
  --orange: #f39c12;
  --army-green: #4b5320;
  --gray: #6b6b6b;
  --brown: #6f4e37;
  --bg: #fbf7f2;
  --card: #fff;
  --maxw: 1100px;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,var(--bg),#fff);color:#222;display:flex;justify-content:center;padding:28px 14px}
.app{width:100%;max-width:var(--maxw)}
header{display:flex;gap:16px;align-items:center;background:linear-gradient(90deg,var(--orange),var(--army-green));color:white;padding:16px;border-radius:12px;box-shadow:0 8px 28px rgba(0,0,0,0.08)}
.logo{width:64px;height:64px;border-radius:12px;background:var(--brown);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:18px;color:white}
.title h1{margin:0;font-size:22px}
.title p{margin:2px 0 0;font-size:13px;opacity:0.95}
nav{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
a.navbtn{padding:8px 12px;border-radius:10px;text-decoration:none;color:white;font-weight:700;background:rgba(0,0,0,0.12)}
main{margin-top:18px}
.screen{display:none}
.screen.active{display:block}
.card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.04);margin-bottom:14px}
.gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px}
.game{border-radius:10px;overflow:hidden;background:linear-gradient(180deg,#fff,#fafafa);display:flex;flex-direction:column;min-height:180px;border-left:6px solid var(--orange);transition:transform 0.2s,box-shadow 0.2s;cursor:pointer}
.game:hover{transform:translateY(-4px);box-shadow:0 12px 24px rgba(0,0,0,0.15)}
.thumb{height:120px;background:linear-gradient(90deg,#eee,#f6f6f6);display:flex;align-items:center;justify-content:center;color:var(--gray);font-weight:700;font-size:16px}
.game .content{padding:12px;display:flex;flex-direction:column;gap:8px;flex:1}
.btn{display:inline-block;padding:8px 12px;border-radius:8px;text-decoration:none;color:white;font-weight:700;background:var(--army-green);border:none;cursor:pointer}
.btn.secondary{background:var(--gray)}
.btn.danger{background:#c94b4b}
.muted{color:var(--gray);font-size:13px}
.rating{display:flex;gap:4px;font-size:18px;cursor:pointer}
.rating span{color:#ccc}
.rating span.active{color:#f39c12}
.small{font-size:13px;color:var(--gray)}
input,textarea{width:100%;padding:8px;border-radius:6px;border:1px solid #e6e6e6;margin-top:6px;font-size:14px}
textarea{min-height:80px;resize:vertical}
.controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:10px}
footer{margin-top:18px;text-align:center;color:var(--gray);font-size:13px;padding-bottom:40px}
.user-list{list-style:none;padding:0;margin:0}
.user-list li{padding:8px;border-bottom:1px solid #ddd;cursor:pointer}
.user-info{margin-top:12px}
</style>
</head>
<body>
<div class="app">
<header>
  <div class="logo">BTS</div>
  <div class="title">
    <h1>Bob the Stickman — Community Games</h1>
    <p>Your community game gallery — submit, review, and play!</p>
    <nav>
      <a href="#" class="navbtn" data-screen="home">Home</a>
      <a href="#" class="navbtn" data-screen="submit">Add a Game</a>
      <a href="#" class="navbtn" data-screen="account">User Account</a>
      <a href="#" class="navbtn" data-screen="adminLogin">Admin</a>
    </nav>
  </div>
</header>
<main>
<!-- HOME -->
<section id="home" class="screen active">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:800">Approved Games</div>
      <div class="small">Stored locally in this browser</div>
    </div>
    <div style="margin-top:12px" id="approvedCount" class="small"></div>
    <div class="gallery cardless" id="approvedList" style="margin-top:12px"></div>
  </div>
</section>

<!-- SUBMIT -->
<section id="submit" class="screen">
  <div class="card">
    <h2>Submit a Game</h2>
    <div id="submitArea"></div>
  </div>
</section>

<!-- USER ACCOUNT -->
<section id="account" class="screen">
  <div class="card" style="max-width:500px;margin:auto">
    <h2>User Account</h2>
    <div id="accountArea"></div>
  </div>
</section>

<!-- ADMIN LOGIN -->
<section id="adminLogin" class="screen">
  <div class="card" style="max-width:560px;margin:auto">
    <h2>Admin Login</h2>
    <form id="loginForm">
      <label>Passcode</label>
      <input type="password" id="adminPass" required>
      <div class="controls">
        <button class="btn" type="submit">Enter Admin</button>
        <button class="btn secondary" type="button" id="cancelLogin">Cancel</button>
      </div>
      <div id="loginMsg" class="small" style="color:#c94b4b;display:none"></div>
    </form>
  </div>
</section>

<!-- ADMIN DASHBOARD -->
<section id="adminDash" class="screen">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2>Admin Dashboard</h2>
      <div class="controls">
        <button class="btn" id="showUsersBtn">Users</button>
        <button class="btn" id="logoutBtn">Logout</button>
      </div>
    </div>

    <!-- USERS -->
    <div id="adminUsersSection" style="display:none">
      <h3>All Users</h3>
      <ul class="user-list" id="userList"></ul>
      <div class="user-info" id="userInfo"></div>
    </div>

    <!-- PENDING -->
    <h3>Pending Submissions</h3>
    <div id="pendingList" class="gallery"></div>
    <div id="noPending" class="small">No pending submissions.</div>

    <!-- APPROVED -->
    <h3>Approved Games</h3>
    <div id="approvedAdminList" class="gallery"></div>
  </div>
</section>
</main>
<footer>
Colors: orange · army green · gray · brown — Site runs entirely in your browser (localStorage).
</footer>
<script>
(function(){
const STORAGE_PENDING='bts_pending';
const STORAGE_APPROVED='bts_approved';
const STORAGE_USERS='bts_users';
const ADMIN_PASS='stego';
const navButtons=document.querySelectorAll('a.navbtn');
const screens=document.querySelectorAll('.screen');
function qs(id){return document.getElementById(id);}
function uid(){return Date.now().toString(36)+'-'+Math.random().toString(36).slice(2,8);}
function readJSON(key,fallback){try{return JSON.parse(localStorage.getItem(key))||fallback}catch(e){return fallback}}
function writeJSON(key,val){localStorage.setItem(key,JSON.stringify(val))}
function safeOpen(url,name='_blank'){window.open(url,name,'noopener');}

let pending=readJSON(STORAGE_PENDING,[]);
let approved=readJSON(STORAGE_APPROVED,[]);
let users=readJSON(STORAGE_USERS,[]);
let currentUser=null;

function showScreen(id){
  screens.forEach(s=>s.classList.toggle('active',s.id===id));
  if(id==='home') renderApprovedList();
  if(id==='adminDash'){renderPending();renderApprovedAdmin();}
  if(id==='account') renderAccount();
  if(id==='submit') renderSubmit();
}

// NAVIGATION
navButtons.forEach(btn=>btn.addEventListener('click',e=>{
  e.preventDefault();
  const target=btn.dataset.screen;
  if(target==='adminLogin'){
    if(sessionStorage.getItem('bts_admin_logged')==='1'){showScreen('adminDash');return}
    showScreen('adminLogin');return;
  }
  showScreen(target);
  window.scrollTo({top:0,behavior:'smooth'});
}));

// =================== APPROVED LIST & PLAY ===================
const approvedListEl=qs('approvedList');
const approvedCount=qs('approvedCount');
function renderApprovedList(){
  approvedListEl.innerHTML='';
  approvedCount.textContent=`Total: ${approved.length}`;
  if(approved.length===0){
    approvedListEl.innerHTML=`<div class="card small">No approved games yet. Be the first to submit!</div>`;
    return;
  }
  approved.forEach(game=>{
    const el=document.createElement('article');
    el.className='game card';
    let ratingHTML='';
    if(currentUser){
      let stars='';
      for(let i=1;i<=5;i++){
        const active=game.ratings && game.ratings[currentUser.username]>=i?'active':'';
        stars+=`<span class="${active}" data-star="${i}" data-game="${game.id}">&#9733;</span>`;
      }
      ratingHTML=`<div class="rating">${stars}</div>`;
    } else {
      ratingHTML='<div class="small">You must be a member to rate.</div>';
    }
    el.innerHTML=`
      <div class="thumb">${game.title}</div>
      <div class="content">
        <div style="display:flex;justify-content:space-between;align-items:flex-start">
          <div>
            <div style="font-weight:800">${game.title}</div>
            <div class="small">By: ${game.creator||'Unknown'}</div>
          </div>
          <div class="small muted">${new Date(game.createdAt).toLocaleString()}</div>
        </div>
        ${ratingHTML}
      </div>`;
    approvedListEl.appendChild(el);

    // PLAY GAME
    el.addEventListener('click',()=>{playGame(game)});
  });
}

// =================== SUBMIT ===================
const submitArea=qs('submitArea');
function renderSubmit(){
  submitArea.innerHTML='';
  if(!currentUser){
    submitArea.innerHTML='<div class="small">You must be a registered user to post a game.</div>';
    return;
  }
  const form=document.createElement('form');
  form.id='submitForm';
  form.innerHTML=`
    <label>Game Title</label>
    <input type="text" id="s_title" required>
    <label>Short Description</label>
    <textarea id="s_message"></textarea>
    <label>Game Link (optional if uploading file)</label>
    <input type="url" id="s_link">
    <label>Upload File (optional if using link)</label>
    <input type="file" id="s_file" accept=".html,.htm,.zip,application/zip">
    <div class="controls">
      <button class="btn" type="submit">Send Submission</button>
      <button class="btn secondary" type="button" id="clearSubmit">Clear</button>
    </div>
  `;
  submitArea.appendChild(form);
  const s_file=qs('s_file');

  form.addEventListener('submit',function(e){
    e.preventDefault();
    const title=qs('s_title').value.trim();
    if(!title){alert('Enter a title');return;}
    const link=qs('s_link').value.trim()||null;
    const message=qs('s_message').value.trim()||'';
    const file=s_file.files && s_file.files[0];
    if(!link && !file){if(!confirm('No link or file provided. Submit anyway?')) return;}
    if(file){
      const reader=new FileReader();
      reader.onload=function(evt){
        pending.unshift({id:uid(),title,currentUser.username,message,link,fileDataUrl:evt.target.result,filename:file.name,createdAt:Date.now()});
        writeJSON(STORAGE_PENDING,pending);
        renderSubmit();
        alert('Submission added to pending queue.');
        showScreen('home');
      };
      reader.readAsDataURL(file);
    } else {
      pending.unshift({id:uid(),title,currentUser.username,message,link,fileDataUrl:null,filename:null,createdAt:Date.now()});
      writeJSON(STORAGE_PENDING,pending);
      renderSubmit();
      alert('Submission added to pending queue.');
      showScreen('home');
    }
  });

  qs('clearSubmit').addEventListener('click',()=>form.reset());
}

// =================== USER ACCOUNT ===================
function renderAccount(){
  const area=qs('accountArea');
  area.innerHTML='';
  if(currentUser){
    area.innerHTML=`<div><strong>Logged in as ${currentUser.username}</strong> | <button class="btn secondary" id="logoutUser">Logout</button></div><div class="small">${currentUser.about||''}</div>`;
    qs('logoutUser').addEventListener('click',()=>{currentUser=null;renderAccount();renderApprovedList();renderSubmit();});
  } else {
    const form=document.createElement('form');
    form.innerHTML=`
      <label>Username</label><input type="text" id="newUsername" required>
      <label>Email</label><input type="email" id="newEmail" required>
      <label>About you</label><textarea id="newAbout"></textarea>
      <div class="controls">
        <button class="btn" type="submit">Create Account / Login</button>
      </div>
    `;
    area.appendChild(form);
    form.addEventListener('submit',e=>{
      e.preventDefault();
      const username=qs('newUsername').value.trim();
      const email=qs('newEmail').value.trim();
      const about=qs('newAbout').value.trim();
      if(!username||!email){alert('Username and email required');return;}
      let user=users.find(u=>u.email===email);
      if(!user){user={username,email,about,playedGames:{},ratings:{}}; users.push(user); writeJSON(STORAGE_USERS,users);}
      currentUser=user;
      renderAccount();
      renderApprovedList();
      renderSubmit();
    });
  }
}

// =================== ADMIN LOGIN ===================
qs('loginForm').addEventListener('submit',function(e){
  e.preventDefault();
  const pass=qs('adminPass').value;
  if(pass===ADMIN_PASS){
    sessionStorage.setItem('bts_admin_logged','1');
    qs('adminPass').value='';
    showScreen('adminDash');
  } else {
    const msg=qs('loginMsg'); msg.textContent='Incorrect passcode'; msg.style.display='block';
    setTimeout(()=>msg.style.display='none',2500);
  }
});
qs('cancelLogin').addEventListener('click',()=>showScreen('home'));
qs('logoutBtn').addEventListener('click',()=>{sessionStorage.removeItem('bts_admin_logged');showScreen('home');});

// =================== ADMIN USERS BUTTON ===================
const showUsersBtn=qs('showUsersBtn');
showUsersBtn.addEventListener('click',()=>{
  const section=qs('adminUsersSection');
  section.style.display=section.style.display==='none'?'block':'none';
  renderUserList();
});

// =================== ADMIN USERS ===================
const userListEl=qs('userList');
const userInfoEl=qs('userInfo');

function renderUserList(){
  userListEl.innerHTML='';
  users.forEach((user,i)=>{
    const li=document.createElement('li');
    li.textContent=user.username + ' (' + user.email + ')';
    li.addEventListener('click',()=>showUserInfo(user));
    userListEl.appendChild(li);
  });
}

function showUserInfo(user){
  let ratingsText='';
  if(user.ratings){
    for(const gid in user.ratings){
      const game=approved.find(g=>g.id===gid);
      if(game) ratingsText+=`<li>${game.title}: ${user.ratings[gid]} stars</li>`;
    }
  }
  let playsText='';
  if(user.playedGames){
    for(const gid in user.playedGames){
      const game=approved.find(g=>g.id===gid);
      if(game) playsText+=`<li>${game.title}: ${user.playedGames[gid]} times</li>`;
    }
  }
  userInfoEl.innerHTML=`
    <h4>${user.username}</h4>
    <div class="small">${user.email}</div>
    <div>${user.about||''}</div>
    <h5>Ratings</h5><ul>${ratingsText||'<li>No ratings yet</li>'}</ul>
    <h5>Played Games</h5><ul>${playsText||'<li>No plays yet</li>'}</ul>
    <button class="btn danger" id="kickUser">Kick / Delete User</button>
  `;
  qs('kickUser').addEventListener('click',()=>{
    if(!confirm('Are you sure you want to delete this user?')) return;
    users=users.filter(u=>u.email!==user.email);
    approved.forEach(g=>{if(g.ratings && g.ratings[user.username]) delete g.ratings[user.username];});
    writeJSON(STORAGE_USERS,users);
    writeJSON(STORAGE_APPROVED,approved);
    userInfoEl.innerHTML='';
    renderUserList();
    renderApprovedList();
    renderApprovedAdmin();
  });
}

// =================== ADMIN PENDING / APPROVED ===================
const pendingListEl=qs('pendingList');
const approvedAdminList=qs('approvedAdminList');

function renderPending(){
  pendingListEl.innerHTML='';
  if(pending.length===0){qs('noPending').style.display='block';return;}
  qs('noPending').style.display='none';
  pending.forEach(item=>{
    const el=document.createElement('article');
    el.className='game card';
    el.innerHTML=`
      <div class="thumb">PENDING</div>
      <div class="content">
        <div style="display:flex;justify-content:space-between;align-items:flex-start">
          <div>
            <div style="font-weight:800">${item.title}</div>
            <div class="small">By: ${item.creator||'Unknown'}</div>
          </div>
          <div class="small muted">${new Date(item.createdAt).toLocaleString()}</div>
        </div>
        <div style="margin-top:auto;display:flex;gap:8px;align-items:center">
          <button class="btn" data-play="${item.id}">Play</button>
          <button class="btn secondary" data-approve="${item.id}">Approve</button>
          <button class="btn danger" data-deny="${item.id}">Deny</button>
        </div>
      </div>`;
    pendingListEl.appendChild(el);
    el.querySelector('[data-play]').addEventListener('click',()=>playGame(item));
    el.querySelector('[data-approve]').addEventListener('click',()=>approveGame(item));
    el.querySelector('[data-deny]').addEventListener('click',()=>denyGame(item));
  });
}

function renderApprovedAdmin(){
  approvedAdminList.innerHTML='';
  approved.forEach(game=>{
    const el=document.createElement('article');
    el.className='game card';
    el.innerHTML=`
      <div class="thumb">${game.title}</div>
      <div class="content">
        <div style="display:flex;justify-content:space-between;align-items:flex-start">
          <div>
            <div style="font-weight:800">${game.title}</div>
            <div class="small">By: ${game.creator||'Unknown'}</div>
          </div>
          <div class="small muted">${new Date(game.createdAt).toLocaleString()}</div>
        </div>
        <div style="margin-top:auto;display:flex;gap:8px;align-items:center">
          <button class="btn" data-play="${game.id}">Play</button>
        </div>
      </div>`;
    approvedAdminList.appendChild(el);
    el.querySelector('[data-play]').addEventListener('click',()=>playGame(game));
  });
}

function approveGame(item){
  if(!confirm('Approve this submission?')) return;
  pending=pending.filter(i=>i.id!==item.id);
  approved.unshift(item);
  writeJSON(STORAGE_PENDING,pending);
  writeJSON(STORAGE_APPROVED,approved);
  renderPending(); renderApprovedAdmin(); renderApprovedList();
}

function denyGame(item){
  if(!confirm('Deny this submission?')) return;
  pending=pending.filter(i=>i.id!==item.id);
  writeJSON(STORAGE_PENDING,pending);
  renderPending();
}

function playGame(item){
  if(item.link) safeOpen(item.link);
  else if(item.fileDataUrl) safeOpen(item.fileDataUrl);
  else alert('No link or file to play.');
}

// =================== INIT ===================
showScreen('home');
})();
</script>
</body>
</html>
